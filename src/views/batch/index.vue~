<template>
<n-button @click="shown.q=!shown.q">Q</n-button>
<n-button @click="shown.a=!shown.a">A</n-button>
<n-button @click="shown.p=!shown.p">P</n-button>
<n-button @click="saveasGroup()">save</n-button>
<n-button v-if="groupsaved" @click="GotoGroup()">View</n-button>
<div style="width:18.76cm">
<div v-for="oo in Tlist" :key="oo.id" >
    <p style="font-size:9.5pt">UUID:<span style="font-family:'courier new'">{{oo.id}}}</span> | qid:<span style="font-family:'courier new'">{{oo.qid}}</span> <span v-if="shown.q">| Info: {{_JSONparse(oo.extra).info}} | Origin: {{_JSONparse(oo.extra).from}}</span></p>
<div v-if="shown.q" v-html="normalizeq(oo.q)" style="font-size:10.5pt;font-family:Cambria , 宋体" ></div>
<div v-if="shown.a"><img :src='"/oss-storage/"+oo.a.replace("<answerparser>","").replace("</answerparser>","").split("|")[0]+".png"'/></div>
<div v-if="shown.p"><img :src='"/oss-storage/"+oo.a.replace("<answerparser>","").replace("</answerparser>","").split("|")[1]+".png"'/></div>
</div></div>
</template>

<script setup>


import { onMounted, ref } from "vue"
import {useRoute,useRouter} from "vue-router"
const route=useRoute(),router=useRouter()

import {NButton} from "naive-ui"

import {normalizeq} from "../../shared/nomorlize_q"

const shown=ref({
    q:true,
    a:false,
    p:false
})

const Tlist=ref([])

Promise.all(route.params.ids.split(",").map(v=>new Promise((res,rej)=>{
fetch("/api/get",{"method":"POST","body":JSON.stringify({id:v}),"headers":{"Content-Type":"application/json"}}).then(o=>o.json()).then(i=>{
    Tlist.value.push(i)
})
}))).then(()=>{

})




const _JSONparse=(v)=>{return JSON.parse(v)}


const saveasGroup=async()=>{
    fetch("/api/group/new",{"method":"POST","body":JSON.stringify({entry:route.params.ids,timestamp:(new Date()).getTime()}),"headers":{"Content-Type":"application/json"}}).then(o=>o.json()).then(i=>{
    groupsaved.value=true
    groupid.value=i.id
})
},groupsaved=ref(false),groupid=ref(""),GotoGroup=async()=>{
    router.push("/group/"+groupid.value)
}
</script>

<style>

</style>
